<template>
  <section class="py-5 gallery-item">
    <MessageNotify
      v-if="message"
      :title="$t('mint.success')"
      :subtitle="$t('mint.successNewNfts')" />
    <div class="columns">
      <div class="column is-two-fifths">
        <MediaItem
          :key="nftImage"
          class="gallery-item-media"
          :src="nftImage"
          :animation-src="nftAnimation"
          :mime-type="nftMimeType"
          :title="nft?.name" />
      </div>
      <div class="column">
        <div
          class="is-flex is-flex-direction-column is-justify-content-space-between h-full">
          <!-- title section -->
          <div>
            <div class="is-flex is-justify-content-space-between">
              <div>
                <h1 class="title">{{ nft?.name }}</h1>
                <h2 class="subtitle">
                  <nuxt-link
                    :to="`/${urlPrefix}/collection/${nft?.collection.id}`"
                    class="has-text-link">
                    {{ nft?.collection.name }}
                  </nuxt-link>
                </h2>
              </div>
              <div class="buttons is-align-content-start">
                <GalleryItemShareBtn />
                <GalleryItemMoreActionBtn class="ml-4" />
              </div>
            </div>

            <div class="is-flex is-flex-direction-row is-flex-wrap-wrap py-4">
              <IdentityItem
                v-if="nft?.issuer"
                class="gallery-avatar"
                :label="`${$t('Creator')}`"
                :prefix="urlPrefix"
                :account="nft?.issuer" />
              <IdentityItem
                v-if="nft?.currentOwner !== nft?.issuer"
                class="gallery-avatar"
                :label="`${$t('Owner')}`"
                :prefix="urlPrefix"
                :account="nft?.currentOwner || ''" />
            </div>
          </div>

          <!-- LINE DIVIDER -->
          <hr />

          <!-- price section -->
          <GalleryItemAction />
        </div>
      </div>
    </div>

    <div class="columns mt-6">
      <div class="column is-two-fifths">
        <GalleryItemDescription />
      </div>

      <div class="column mobile-top-margin">
        <GalleryItemTabsPanel />
      </div>
    </div>

    <CarouselTypeRelated
      v-if="nft?.collection.id"
      class="mt-6"
      :collection-id="nft?.collection.id"
      data-cy="carousel-related" />

    <CarouselTypeVisited class="mt-6" />
  </section>
</template>

<script setup lang="ts">
import { IdentityItem, MediaItem } from '@kodadot1/brick'

import { useGalleryItem } from './useGalleryItem'
import GalleryItemShareBtn from './GalleryItemShareBtn.vue'
import GalleryItemMoreActionBtn from './GalleryItemMoreActionBtn.vue'
import GalleryItemDescription from './GalleryItemDescription.vue'
import GalleryItemTabsPanel from './GalleryItemTabsPanel/GalleryItemTabsPanel.vue'
import GalleryItemAction from './GalleryItemAction/GalleryItemAction.vue'
import { exist } from '@/components/search/exist'

const { urlPrefix } = usePrefix()
const { nft, nftImage, nftAnimation, nftMimeType } = useGalleryItem()
const route = useRoute()
const router = useRouter()
const message = ref('')

const CarouselTypeRelated = defineAsyncComponent(
  () => import('@/components/carousel/CarouselTypeRelated.vue')
)
const CarouselTypeVisited = defineAsyncComponent(
  () => import('@/components/carousel/CarouselTypeVisited.vue')
)

onMounted(() => {
  exist(route.query.message, (val) => {
    message.value = val === 'congrats' ? val : ''
    router.replace({ query: { redesign: 'true' } })
  })
})
</script>

<style lang="scss" scoped>
.title {
  font-size: 2.4375em;
}

.mobile-top-margin {
  margin-top: unset;
}

@media screen and (max-width: 768px) {
  .mobile-top-margin {
    margin-top: 1.25rem;
  }
}
</style>
