<template>
  <div>
    <NeoField
      :label="$i18n.t(label)"
      :class="{ 'o-field__message-hide': hasFocus && message }">
      <NeoInput
        ref="input"
        :value="value"
        :placeholder="placeholder"
        :expanded="expanded"
        :maxlength="maxlength"
        :required="required"
        :disabled="disabled"
        :has-counter="hasCounter"
        :type="type"
        :pattern="!value && required ? `^\\S+` : '.*'"
        @blur="hasFocus = false"
        @focus="hasFocus = true"
        @input="handleInput" />
    </NeoField>
    <div v-if="hasFocus && message">
      <transition name="fade">
        <div class="has-text-primary is-italic is-size-7 mb-3 mt-1">
          {{ message }}
        </div>
      </transition>
    </div>
  </div>
</template>

<script lang="ts" setup>
import type { BInput } from 'buefy/dist/components/input'
import { NeoField, NeoInput } from '@kodadot1/brick'

const { $i18n } = useNuxtApp()

withDefaults(
  defineProps<{
    value?: string
    label: string
    placeholder: string
    expanded?: boolean
    message?: string
    maxlength?: string
    type?: string
    required?: boolean
    disabled?: boolean
    hasCounter?: boolean
  }>(),
  {
    value: '',
    expanded: false,
    type: '',
    message: '',
    required: false,
    disabled: false,
    hasCounter: true,
    maxlength: undefined,
  }
)

const hasFocus = ref(false)
const emit = defineEmits(['input'])
const input = ref<BInput>(null)

function checkValidity() {
  return input.value?.checkHtml5Validity()
}

const handleInput = (value: string) => {
  emit('input', value.trim())
}

defineExpose({ checkValidity })
</script>

<style scoped>
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.5s;
}

.fade-enter,
.fade-leave-to {
  opacity: 0;
}
</style>
