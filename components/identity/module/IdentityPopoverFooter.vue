<template>
  <div class="popover-stats-container is-flex is-flex-direction-column pt-2">
    <div class="pb-2">
      <div
        class="is-flex is-align-items-center is-justify-content-space-between">
        <span class="is-size-6">{{ $t('profile.collected') }}</span>

        <p class="is-size-6" data-testid="identity-collected">
          {{ totalCollected }}
        </p>
      </div>
      <div
        class="is-flex is-align-items-center is-justify-content-space-between">
        <span class="is-size-6">{{ $t('profile.created') }}</span>

        <p class="is-size-6" data-testid="identity-created">
          {{ totalCreated }}
        </p>
      </div>
      <div
        class="is-flex is-align-items-center is-justify-content-space-between">
        <span class="is-size-6">{{ $t('profile.sold') }}</span>

        <p class="is-size-6" data-testid="identity-sold">
          {{ totalSold }}
        </p>
      </div>
    </div>
    <div v-if="soldItems.length" class="sales-container pt-2">
      <h6 class="popover-user-heading pb-2">
        {{ $t('profile.highestSales') }}
      </h6>
      <div class="is-flex sold-items">
        <div v-for="nft in soldItems" :key="nft.id" class="sold-item">
          <GalleryCard
            :id="nft.id"
            hide-name
            :metadata="nft.metadata"
            :current-owner="nft.currentOwner"
            :route="`/${urlPrefix}/gallery`"
            :data-testid="soldItems.indexOf(nft)" />
        </div>
      </div>
    </div>
  </div>
</template>

<script lang="ts" setup>
import useIdentityStats from '../utils/useIdentityStats'

import type { NFT } from '@/components/rmrk/service/scheme'

const GalleryCard = defineAsyncComponent(
  () => import('../../rmrk/Gallery/GalleryCard.vue')
)

const address = inject('address')
const { urlPrefix } = usePrefix()
const { totalCollected, totalCreated, totalSold } = useIdentityStats({
  address,
})

defineProps<{
  soldItems: NFT[]
}>()
</script>

<style lang="scss" scoped>
@import '@/assets/styles/abstracts/variables';

.sold-items {
  gap: 10px;

  .sold-item {
    width: 78px;
    height: 78px;

    @include ktheme() {
      border: 1px solid theme('border-color');
    }
  }
}

.sales-container {
  @include ktheme() {
    border-top: 1px solid theme('k-grey');
  }
}

.popover-user-heading {
  font-size: 12px;

  @include ktheme() {
    color: theme('k-grey');
  }
}
</style>
